<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<!--
`virtual-chat`
Chat component that simulates several people is talking

@demo demo/index.html 
-->
<dom-module id="virtual-chat">
	<template>
		<style is="custom-style">
			.flex-horizontal {
				@apply(--layout-horizontal);
			}
			
			.flexchild {
				@apply(--layout-flex);
			}

		</style>
		<header>
			<h2>[[name]]</h2>
		</header>
		<div class="container flex-horizontal">
			<div>
				<paper-listbox>
					<template is="dom-repeat" items="[[_users]]" as="user">
						<paper-item>[[user]]</paper-item>
					</template>
				</paper-listbox>
			</div>
			<div class="flexchild" id="chat"></div>
			<div>three</div>
		</div>
	</template>
	<script>
		Polymer({

			is: 'virtual-chat',

			properties: {

				/**
				 * Words per minute, to calculate time between posts
				 */
				WPM: {
					type: Number,
					readOnly: true,
					value: 41
				},

				/**
				 * Name of the chat
				 */
				name: {
					type: String
				},
				/**
				 * Conversation to configure component.
				 *
				 * @type Array<{user: String, message: String}>
				 */
				script: {
					type: Object,
					value: function () {
						return {}
					},
					observer: '_handleScript'
				},
				/**
				 * Array of users
				 *
				 * @type Array<String>
				 */
				_users: {
					type: Array
				}
			},

			_feedChat: function (user, message) {
				var chatDiv;
				var p;
				var words;
				var seconds;

				if (this._users.indexOf(user) === -1) {
					this.push('_users', user);
				}

				chatDiv = this.$.chat;
				p = document.createElement('p');
				p.innerHTML += '<b>' + user + ':</b>'

				words = message.split(' ').length;
				seconds = (words / this.WPM) * 60; // seconds typing

				// Set timers taking in account accumulated time
			},

			_handleScript: function (script) {
				script.forEach(function lineHandler(user, message) {
					this._feedChat(user, message);
				})
			}
		});

	</script>
</dom-module>
